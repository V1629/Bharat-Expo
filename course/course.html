<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Educ8</title>
    <link rel="stylesheet" href="course.css">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
</head>
<body>
    <!-- Navbar Section -->
    <nav class="navbar">
        <div class="navbar-logo">
            <h1>EDUCA8</h1>
        </div>
        <div class="navbar-search">
            <span class="material-icons search-icon">search</span>
            <input type="text" id="search" placeholder="Search...">
            <button id="micBtn">
                <span class="material-icons mic-icon">mic</span>
            </button>
        </div>
        <div class="navbar-links">
            <a href="../index.html">Home</a>
            <a href="#courses">Courses</a>
            <a href="#services">Services</a>
            <a href="../login.html">Register Now</a>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container">
        <!-- Video Player Section -->
        <div class="video-player">
            <video id="main-video" controls>
                <source src="sample-video.mp4" type="video/mp4">
                Your browser does not support the video tag.
            </video>
            <h2 id="video-title">Sample Video Title</h2>
            <p id="video-description">This is the description of the main video. You can update it based on the selected video.</p>
        </div>

        <!-- Suggestions Section -->
        <aside class="suggestions" id="suggestions-container">
            <h3>Suggestions</h3>
            <!-- This will be populated with recommended courses -->
        </aside>
    </div>
    <script>
        async function getRecommendations(videoId) {
            try {
                // Make the API request
                const response = await fetch('http://127.0.0.1:8000/recommend/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ course_id: videoId }), // This key should match what the backend expects
                });
    
                // Handle non-200 HTTP responses
                if (!response.ok) {
                    throw new Error(`HTTP error! Status: ${response.status}`);
                }
    
                // Parse response data
                const data = await response.json();
                console.log('API Response:', data); // Debug: See the API response
    
                // Extract and collect video IDs
                let recommendedCourses = [];
                if (data && data.recommended_courses) {
                    for (let i = 0; i < data.recommended_courses.length; i++) {
                        recommendedCourses.push(data.recommended_courses[i].videoId);
                        console.log('Recommended Course ID:', data.recommended_courses[i].videoId); // Debug: See each videoId
                    }
                } else {
                    console.warn('No recommended courses found in API response.');
                }
                return recommendedCourses;
            } catch (error) {
                console.error('Error fetching recommendations:', error);
            }
        }
    
        async function fetching() {
            // Test with a sample videoId (replace 'sM2C-SsREgM' as needed)
            let new_courses = await getRecommendations('tXXnxjj2wM4');
            console.log('New Courses:', new_courses); // Debug: Ensure courses are fetched
            populateHTML(new_courses);
        }
    
        function populateHTML(courseIds) {
            // Select the main container to append videos to (Assuming it is `.container`)
            const container = document.querySelector('.container'); // Adjust the selector to your main section
    
            if (!container) {
                console.error('Main container not found.');
                return;
            }
    
            // Populate container with video iframes
            if (courseIds && courseIds.length > 0) {
                courseIds.forEach(videoId => {
                    // Create a wrapper for each recommended video
                    const wrapperDiv = document.createElement('div');
                    wrapperDiv.className = 'recommended-video';
    
                    // Create an iframe for each videoId
                    const iframeElement = document.createElement('iframe');
                    iframeElement.src = `https://www.youtube.com/embed/${videoId}`;
                    iframeElement.width = '560';  // Set width of iframe
                    iframeElement.height = '315'; // Set height of iframe
                    iframeElement.frameborder = '0';
                    iframeElement.allow = 'accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture';
                    iframeElement.allowfullscreen = true;
    
                    // Optionally, add a title for the iframe
                    const titleElement = document.createElement('p');
                    titleElement.textContent = `Recommended Video ID: ${videoId}`;
    
                    // Append title and iframe to the wrapper, and then to the container
                    wrapperDiv.appendChild(titleElement);
                    wrapperDiv.appendChild(iframeElement);
                    container.appendChild(wrapperDiv);
                });
            } else {
                // No valid courses
                const noDataMessage = document.createElement('p');
                noDataMessage.textContent = 'No recommendations available.';
                container.appendChild(noDataMessage);
            }
        }
        // Call the fetching function on page load
        fetching();
    </script>
    
    <!-- <script src="course.js"></script> -->
    <script src="https://www.chatbase.co/embed.min.js" chatbotId="NK0MBNjh2kVXrO3_qtiiT" domain="www.chatbase.co" defer></script>
</body>
</html>
